<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Season's Greetings</title>
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Bodoni+Moda+SC:opsz,wght@6..96,400..900&family=Cormorant+Garamond&family=Cinzel:wght@400;600&family=Great+Vibes&family=Italianno&family=Noto+Serif+JP:wght@300;500&family=Playfair+Display:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">
    
    <style>
        /* Base Settings */
        :root {
            --gold: #C5A059;
            --gold-light: #E6C888;
            --gold-pale: #DBC4A0; /* Less saturated, softer gold for frames */
            --gold-dark: #8A6E30;
            --bg-color: #ACD7E7;
            --card-white: #FDFBF7;
            --envelope-cream: #E8E2D2; /* Smooth Beige for envelope */
            --envelope-color: var(--envelope-cream); 
            --envelope-inner: #D8D2C2; /* Slightly darker inside */
            /* --envelope-inner should match cream roughly for flap inners? Or match card pocket? */
            /* Using cream for flap inner to look like same paper */
            --flap-inner-color: var(--envelope-cream); 
            --border-blue-gray: #b2ab90; /* Taupe/Beige */
            --border-width: 6px;
            --border-inset: 12px;
            --inner-margin: 15px;
            --gold-paper-gap: 5px; /* Gap between white paper and gold border */
            
            /* Radius Logic */
            --gold-radius: 25px; /* The radius of the gold border cut */
            --white-cut-radius: calc(var(--gold-radius) - var(--gold-paper-gap));
            
            /* Paper Texture (SVG Noise) */
--paper-texture: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 700 700' width='700' height='700' opacity='0.3'%3E%3Cdefs%3E%3Cfilter id='nnnoise-filter' x='-20%25' y='-20%25' width='140%25' height='140%25' filterUnits='objectBoundingBox' primitiveUnits='userSpaceOnUse' color-interpolation-filters='linearRGB'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.1' numOctaves='4' seed='15' stitchTiles='stitch' x='0%25' y='0%25' width='100%25' height='100%25' result='turbulence'/%3E%3CfeSpecularLighting surfaceScale='6' specularConstant='2.3' specularExponent='20' lighting-color='%238b572a' x='0%25' y='0%25' width='100%25' height='100%25' in='turbulence' result='specularLighting'%3E%3CfeDistantLight azimuth='3' elevation='181'/%3E%3C/feSpecularLighting%3E%3CfeColorMatrix type='saturate' values='0' x='0%25' y='0%25' width='100%25' height='100%25' in='specularLighting' result='colormatrix'/%3E%3C/filter%3E%3C/defs%3E%3Crect width='100%25' height='100%25' fill='%238b572a' filter='url(%23nnnoise-filter)'/%3E%3C/svg%3E");        
        }

        body {
            font-family: 'Playfair Display', serif;
            background-color: var(--bg-color);
            color: #333;
            overflow: hidden; /* Prevent scroll */
            touch-action: manipulation;
        }

        /* Utility for 3D Context */
        .scene {
            width: 100vw;
            height: 100vh; /* Fallback */
            height: 100dvh; /* Fix mobile vertical center */
            display: flex;
            justify-content: center;
            align-items: center;
            position: relative;
            z-index: 10;
        }

        /* --- Bokeh Background --- */
        #bokeh-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 0; /* Behind snow, in front of body bg */
            overflow: hidden;
        }

        .bokeh-light {
            position: absolute;
            border-radius: 50%;
            background: radial-gradient(circle, rgba(255, 248, 220, 0.4) 0%, rgba(255, 248, 220, 0) 70%);
            filter: blur(5px);
            opacity: 0;
            animation: float-bokeh 20s infinite linear, twinkle-bokeh 8s infinite ease-in-out;
        }

        @keyframes float-bokeh {
            0% { transform: translateY(0) translateX(0); }
            50% { transform: translateY(-20px) translateX(10px); }
            100% { transform: translateY(0) translateX(0); }
        }

        @keyframes twinkle-bokeh {
            0%, 100% { opacity: 0.1; transform: scale(0.8); }
            50% { opacity: 0.5; transform: scale(1.1); }
        }
        
        /* --- Envelope Styles --- */
        .envelope-wrapper {
            position: absolute;
            width: min(90vw, 500px);
            height: min(60vw, 330px); /* 3:2 Aspect Ratio */
            transform-style: preserve-3d;
            transition: transform 2.5s cubic-bezier(0.25, 0.8, 0.25, 1); /* Slower fly-in */
            opacity: 0;
            transform: translateY(-120vh) rotateX(20deg); /* Start from outside */
            cursor: pointer;
            will-change: transform, opacity; /* GPU Assist */
        }
        
        .envelope-wrapper.animate-in {
            opacity: 1;
            transform: translateY(0) rotateX(0);
        }

        .envelope-body {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 100%;
            /* background-color: var(--envelope-color); replaced by SVG */
            z-index: 10;
            /* clip-path removed */
            pointer-events: none; /* Let clicks pass through transparent areas */
            filter: drop-shadow(0 10px 20px rgba(0,0,0,0.4));
            transform: translateZ(0);
        }

        .envelope-body svg {
            width: 100%;
            height: 100%;
            display: block;
            pointer-events: auto; /* Catch clicks on the paper itself */
        }
        
        .envelope-shape {
            fill: var(--envelope-cream);
            stroke: none;
        }

        .envelope-lines {
            fill: none;
            stroke: var(--border-blue-gray);
            stroke-width: 12; /* Thick border */
            stroke-linejoin: round;
            stroke-linecap: round;
        }

        .envelope-back {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 100%;
            background-color: var(--envelope-inner);
            background-image: var(--paper-texture);
            z-index: 1;
            transform: translateZ(-10px);
        }

        .envelope-flap {
            position: absolute;
            top: 0;
            width: 100%;
            height: 55%; /* Flap height */
            /* background color/clip-path removed */
            transform-origin: top;
            transition: transform 0.8s ease-in-out, z-index 0s linear 0.4s;
            z-index: 20; /* Initially above card */
            filter: drop-shadow(0 5px 10px rgba(0,0,0,0.1));
            pointer-events: none;
            transform: translateZ(1px); /* Ensure it sits in front of body */
            transform-style: preserve-3d; /* Enable double-sided support */
            will-change: transform;
        }
        
        /* Flap Faces Logic */
        .flap-content {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            -webkit-backface-visibility: hidden;
        }

        .flap-outer {
            z-index: 2;
            transform: rotateX(0deg);
        }

        .flap-inner {
            z-index: 1;
            transform: rotateX(180deg);
        }

        /* SVG styles for flap */
        .flap-content svg {
            width: 100%;
            height: 100%;
            display: block;
            pointer-events: auto;
        }
        
        /* Special class for inner flap lines (no border) */
        .envelope-lines.inner-face {
            stroke: none; /* No border for inside */
        }

        .envelope-flap.open {
            transform: translateZ(-10px) rotateX(180deg);
            z-index: 0; /* Move behind after opening */
            transition: transform 0.8s ease-in-out, z-index 0s linear 0.4s;
        }
        
            /* Container for Seal */
        .envelope-seal {
            position: absolute;
            bottom: -25px; /* Hang off the bottom tip of the flap */
            left: 50%;
            transform: translateX(-50%);
            width: 80px; /* Slightly larger for organic feel */
            height: 80px;
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 25;
            
            /* Hide when open (if backface-visibility fails or for explicit control) */
            transition: opacity 1s ease-in-out; 
            opacity: 1;
            
            /* Apply drop shadow to whatever content is inside (CSS shape or PNG) */
            filter: drop-shadow(0 4px 8px rgba(0,0,0,0.3));
        }
        
        .envelope-seal.fade-out {
             opacity: 0;
        }
        
        /* CSS Fallback Seal */
        .seal-css {
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #CFB53B, #8A6E30); /* Gold gradient */
            /* Organic Shape */
            border-radius: 50% 55% 52% 48% / 50% 50% 55% 45%;
            /* Removed outer shadow, kept inset */
            box-shadow: inset 0 2px 4px rgba(255,255,255,0.4);
            border: 2px solid #E6C888;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        /* If image is present (uncommented), hide the CSS fallback */
        .seal-image + .seal-css {
            display: none;
        }
        
        .seal-css::after {
            content: "";
            width: 70%;
            height: 70%;
            border-radius: 50%;
            border: 1px dashed rgba(255,255,255,0.3);
            box-shadow: inset 0 2px 4px rgba(0,0,0,0.2);
        }

        /* Image Placeholder */
        .seal-image {
            position: absolute;
            width: 100%;
            height: 100%;
            object-fit: contain;
            z-index: 2;
            /* If src is set, it covers the CSS seal. If missing/hidden, CSS seal shows. */
        }

        /* Back Signatures */
        .envelope-signatures {
            position: absolute;
            bottom: 20px;
            width: 100%;
            text-align: center;
            font-family: 'Great Vibes', cursive;
            font-size: 1.2rem;
            color: #8A6E30; /* Dark Gold */
            z-index: 15;
            pointer-events: none;
            opacity: 0.8;
        }

        /* --- Card Styles --- */
        .card-container {
            position: absolute;
            width: min(85vw, 470px);
            height: min(56vw, 310px); /* Slightly smaller than envelope */
            left: 50%;
            bottom: 5px;
            bottom: 5px;
            transform: translateX(-50%) translateZ(-5px);
            transform-style: preserve-3d;
            will-change: transform;
            /* Update: Slower transition for elegant movement (2.5s) */
            transition: transform 2.5s ease-in-out, bottom 1s ease-in-out;
            z-index: 5; /* Inside envelope initially */
        }

        /* Card Animation States */
        .card-container.pulled-out {
            /* Pull up, then move forward (Z), then center */
            animation: pullOutCard 2.5s forwards;
            /* z-index is controlled within keyframes now */
            will-change: transform; /* GPU Assist */
        }

        /* State after animation finishes: Ready for interaction */
        .card-container.interactive {
            animation: none; /* Stop animation to allow transition */
            /* Match the 100% state of pullOutCard */
            transform: translateX(-50%) translateY(50%) translateZ(50px);
            bottom: 50%;
            z-index: 50;
        }

        @keyframes pullOutCard {
            0% { 
                transform: translateX(-50%) translateY(0) translateZ(-5px);
                z-index: 5;
            }
            40% { 
                transform: translateX(-50%) translateY(-120%) translateZ(-5px); 
                z-index: 5; /* Keep behind envelope body while rising */
            }
            41% {
                z-index: 50; /* Switch to front after clearing the pocket */
            }
            60% { 
                transform: translateX(-50%) translateY(-120%) translateZ(25px); 
                z-index: 50;
            }
            100% { 
                transform: translateX(-50%) translateY(50%) translateZ(50px); 
                bottom: 50%; 
                z-index: 50; /* Keep in front */
            }
        }

        /* The Card Fold Logic */
        .card {
            width: 100%;
            height: 100%;
            position: relative;
            transform-style: preserve-3d;
        }

        /* Upper Half (Front Cover / Inside Top) */
        .card-upper {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            transform-origin: top;
            transform-style: preserve-3d;
            /* Update: Slower open speed to match movement */
            transition: transform 2.5s ease-in-out;
            z-index: 2; /* Ensure it covers the lower part */
            will-change: transform; /* GPU Assist */
        }
        
        .card-container.card-open .card-upper {
            transform: rotateX(180deg); /* Fully open to 180 degrees */
        }

        /* When card opens, shift the whole container down smoothly */
        .card-container.card-open {
            /* Move down further to center the opened card */
            transform: translateX(-50%) translateY(100%) translateZ(50px) !important;
        }
        
        /* Force remove shadow when open to flatten the look */
        .card-container.card-open .face {
            box-shadow: none !important;
        }
        /* Also remove inset shadows from image frames when open to ensure seamless look */
        .card-container.card-open .framed-image-half {
            box-shadow: none !important;
        }

        /* Faces of the Upper Card */
        .face {
            position: absolute;
            width: 100%;
            height: 100%;
            backface-visibility: hidden;
            -webkit-backface-visibility: hidden;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        /* Front Cover Design */
        .face-front {
            background: var(--card-white);
            /* border moved to inner element */
            /* border: 12px solid var(--border-blue-gray); */ 
            box-sizing: border-box;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 2;
            transform: rotateX(0deg) translateZ(1px);
        }

        /* Inside Top Design (Back of the front cover) */
        .face-back {
            background: var(--border-blue-gray); /* Layout background */
            transform: rotateX(180deg) translateZ(1px);
            display: flex;
            flex-direction: column;
            position: relative; /* Ensure it is a positioning context */
            
            /* Align content to start (top) */
            justify-content: flex-start;
            
            /* Fixed padding from top to position Happy Holidays closer to edge */
            padding-top: 25px; 
            
            align-items: center;
            box-shadow: none; /* Remove shadow to blend with lower part at hinge */
            
            /* Hinge Fix: Extend slightly to overlap lower card and hide gap */
            height: 100.5%; 
            
            /* Reset padding to allow margin auto to work for centering */
            padding-bottom: 0;
            overflow: hidden; /* Clip shadow at the fold/hinge */
        }

        /* White Paper Insert (Upper) */
        .face-back::before {
            content: "";
            position: absolute;
            top: var(--inner-margin);
            left: var(--inner-margin);
            right: var(--inner-margin);
            bottom: 0;
            
            /* Inverted Corners Logic for White Paper */
            /* Offset center by gap to match gold border center physically */
            background: 
                radial-gradient(circle var(--white-cut-radius) at var(--gold-paper-gap) var(--gold-paper-gap), transparent var(--white-cut-radius), var(--card-white) calc(var(--white-cut-radius) + 0.5px)) top left,
                radial-gradient(circle var(--white-cut-radius) at calc(100% - var(--gold-paper-gap)) var(--gold-paper-gap), transparent var(--white-cut-radius), var(--card-white) calc(var(--white-cut-radius) + 0.5px)) top right;
            background-size: 51% 100%; /* Split vertically */
            background-repeat: no-repeat;
            background-color: transparent; /* Ensure no underlying fill interferes */
            
            /* Old border-radius removed */
            /* border-radius: var(--inner-radius) var(--inner-radius) 0 0; */
            z-index: 0;
            filter: drop-shadow(0 2px 6px rgba(0,0,0,0.25)); /* Shadow for layered paper effect */
        }

        /* Lower Half (Inside Bottom) - Actually the static base */
        .card-lower {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--border-blue-gray); /* Layout background */
            z-index: 1; /* Behind upper initially */
            display: flex; /* Initially hidden by upper */
            flex-direction: column;
            
            /* Align content to end (bottom) */
            justify-content: flex-end;
            
            /* Fixed padding from bottom to position message closer to edge */
            padding-bottom: 30px;
            
            align-items: center;
            /* border: 1px solid #ddd; <- Removed border to prevent seam line */
            border-top: none; 
            backface-visibility: hidden;
            
            /* Reset padding to allow margin auto to work for centering */
            padding-top: 0;
            overflow: hidden; /* Clip shadow at the fold/hinge */
        }

        /* White Paper Insert (Lower) */
        .card-lower::before {
            content: "";
            position: absolute;
            top: 0;
            left: var(--inner-margin);
            right: var(--inner-margin);
            bottom: var(--inner-margin);
            
             /* Inverted Corners Logic for White Paper */
            background: 
                radial-gradient(circle var(--white-cut-radius) at var(--gold-paper-gap) calc(100% - var(--gold-paper-gap)), transparent var(--white-cut-radius), var(--card-white) calc(var(--white-cut-radius) + 0.5px)) bottom left,
                radial-gradient(circle var(--white-cut-radius) at calc(100% - var(--gold-paper-gap)) calc(100% - var(--gold-paper-gap)), transparent var(--white-cut-radius), var(--card-white) calc(var(--white-cut-radius) + 0.5px)) bottom right;
            background-size: 51% 100%;
            background-repeat: no-repeat;
            background-color: transparent;
            
            /* Old border-radius removed */
            /* border-radius: 0 0 var(--inner-radius) var(--inner-radius); */
            z-index: 0;
            filter: drop-shadow(0 2px 6px rgba(0,0,0,0.25)); /* Shadow for layered paper effect */
        }


        /* Content Wrappers for centering text in available space */
        .text-area-top {
            flex-grow: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            width: 100%;
            padding-bottom: 5px;
            position: relative;
            z-index: 1; /* Ensure above white paper */
        }

        .text-area-bottom {
            flex-grow: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            width: 100%;
            padding-top: 5px;
            position: relative;
            z-index: 1; /* Ensure above white paper */
        }

        /* --- Blue Gray Inner Border --- */
        .front-border-inner {
            position: absolute;
            top: var(--border-inset);
            left: var(--border-inset);
            right: var(--border-inset);
            bottom: var(--border-inset);
            border: var(--border-width) solid var(--border-blue-gray);
            pointer-events: none;
            z-index: 5; /* Below text but above background */
        }


        /* --- Design Details --- */
        /* Updated: Double Gold Frame (Inverted Corners) with ::after for second line */
        .gold-border-double {
            position: absolute;
            pointer-events: none;
            z-index: 10;
            
            /* Settings */
            --b: 1px; /* Thinner for double line */
            --gap: 3px; /* Gap between lines */
            --r: var(--gold-radius); 
            --color: var(--gold);
            
            /* Positioning Logic */
            --gold-inset: calc(var(--inner-margin) + var(--gold-paper-gap));
            
            top: var(--gold-inset); 
            left: var(--gold-inset); 
            right: var(--gold-inset); 
            bottom: var(--gold-inset);
            
            border: none;
            box-shadow: none;
        }

        /* Inner Line Logic using ::after */
        .gold-border-double::after {
            content: "";
            position: absolute;
            inset: var(--gap);
            border: none;
            z-index: 10;
            pointer-events: none;
            
            /* Inner Radius Math: r + gap ensures concentric inverted corners */
            --r-inner: calc(var(--r) + var(--gap));
        }

        /* ------------------------------------------- */
        /* Lower Half Borders (U-Shape)                */
        /* ------------------------------------------- */
        
        /* Outer Line */
        .card-lower .gold-border-double {
            top: 0; 
            background:
                linear-gradient(to right, var(--color), var(--color)) bottom center / calc(100% - 2*var(--r)) var(--b) no-repeat,
                linear-gradient(to bottom, var(--color), var(--color)) left top / var(--b) calc(100% - var(--r)) no-repeat,
                linear-gradient(to bottom, var(--color), var(--color)) right top / var(--b) calc(100% - var(--r)) no-repeat,
                radial-gradient(circle var(--r) at 0 100%, transparent calc(100% - var(--b) - 0.5px), var(--color) calc(100% - var(--b)), var(--color) 100%, transparent 100%) bottom left / var(--r) var(--r) no-repeat,
                radial-gradient(circle var(--r) at 100% 100%, transparent calc(100% - var(--b) - 0.5px), var(--color) calc(100% - var(--b)), var(--color) 100%, transparent 100%) bottom right / var(--r) var(--r) no-repeat;
        }

        /* Inner Line */
        .card-lower .gold-border-double::after {
            top: 0; /* Override inset to close gap at hinge */
            background:
                linear-gradient(to right, var(--color), var(--color)) bottom center / calc(100% - 2*var(--r)) var(--b) no-repeat,
                linear-gradient(to bottom, var(--color), var(--color)) left top / var(--b) calc(100% - var(--r)) no-repeat,
                linear-gradient(to bottom, var(--color), var(--color)) right top / var(--b) calc(100% - var(--r)) no-repeat,
                /* Adjusted Radial Gradients for Inner Concentricity */
                radial-gradient(circle var(--r-inner) at calc(0px - var(--gap)) calc(100% + var(--gap)), transparent calc(100% - var(--b) - 0.5px), var(--color) calc(100% - var(--b)), var(--color) 100%, transparent 100%) bottom left / var(--r-inner) var(--r-inner) no-repeat,
                radial-gradient(circle var(--r-inner) at calc(100% + var(--gap)) calc(100% + var(--gap)), transparent calc(100% - var(--b) - 0.5px), var(--color) calc(100% - var(--b)), var(--color) 100%, transparent 100%) bottom right / var(--r-inner) var(--r-inner) no-repeat;
        }

        /* ------------------------------------------- */
        /* Upper Half Borders (Inverted U-Shape)       */
        /* ------------------------------------------- */

        /* Outer Line */
        .face-back .gold-border-double {
            bottom: 0; 
            background:
                linear-gradient(to right, var(--color), var(--color)) top center / calc(100% - 2*var(--r)) var(--b) no-repeat,
                linear-gradient(to bottom, var(--color), var(--color)) left bottom / var(--b) calc(100% - var(--r)) no-repeat,
                linear-gradient(to bottom, var(--color), var(--color)) right bottom / var(--b) calc(100% - var(--r)) no-repeat,
                radial-gradient(circle var(--r) at 0 0, transparent calc(100% - var(--b) - 0.5px), var(--color) calc(100% - var(--b)), var(--color) 100%, transparent 100%) top left / var(--r) var(--r) no-repeat,
                radial-gradient(circle var(--r) at 100% 0, transparent calc(100% - var(--b) - 0.5px), var(--color) calc(100% - var(--b)), var(--color) 100%, transparent 100%) top right / var(--r) var(--r) no-repeat;
        }

        /* Inner Line */
        .face-back .gold-border-double::after {
            bottom: 0; /* Override inset to close gap at hinge */
            background:
                linear-gradient(to right, var(--color), var(--color)) top center / calc(100% - 2*var(--r)) var(--b) no-repeat,
                linear-gradient(to bottom, var(--color), var(--color)) left bottom / var(--b) calc(100% - var(--r)) no-repeat,
                linear-gradient(to bottom, var(--color), var(--color)) right bottom / var(--b) calc(100% - var(--r)) no-repeat,
                /* Adjusted Radial Gradients for Inner Concentricity */
                radial-gradient(circle var(--r-inner) at calc(0px - var(--gap)) calc(0px - var(--gap)), transparent calc(100% - var(--b) - 0.5px), var(--color) calc(100% - var(--b)), var(--color) 100%, transparent 100%) top left / var(--r-inner) var(--r-inner) no-repeat,
                radial-gradient(circle var(--r-inner) at calc(100% + var(--gap)) calc(0px - var(--gap)), transparent calc(100% - var(--b) - 0.5px), var(--color) calc(100% - var(--b)), var(--color) 100%, transparent 100%) top right / var(--r-inner) var(--r-inner) no-repeat;
        }

        .stamp-placeholder {
            position: absolute;
            top: 25px;
            right: 25px;
            width: min(18vw, 80px);
            height: min(22vw, 95px);
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: hidden;
        }
        
        .stamp-placeholder img {
            width: 100%; height: 100%; object-fit: contain;
        }

        .signatures {
            position: absolute;
            bottom: 30px;
            right: 30px;
            text-align: right;
            font-family: 'Great Vibes', cursive;
            font-size: clamp(1.2rem, 3vw, 2rem);
            color: var(--gold-dark);
            line-height: 1.2;
        }

        .front-content-wrapper {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            gap: 2px; /* Close gap completely to control with margins/line-height */
            z-index: 10;
        }

        .front-signatures {
            font-family: 'Cormorant Garamond', serif;
            font-size: clamp(0.3rem, 1.3vw, 0.8rem); /* Slightly smaller for balance */
            color: var(--gold-dark);
            letter-spacing: 0.1em;
            text-transform: none;
            line-height: 1.1; /* Tighter line height */
        }

        .separator-line {
            width: 360px; /* Short elegant line */
            height: 1px;
            background-color: var(--gold-dark);
            margin: 2px 0; /* Tighter spacing */
            opacity: 0.7;
        }

        /* --- Shimmer Animation --- */
        @keyframes shimmer {
            0% {
                background-position: -200% center;
            }
            100% {
                background-position: 200% center;
            }
        }

        .card-text-main {
            /* Text Shimmer Effect */
            background: linear-gradient(
                120deg, 
                var(--gold-dark) 0%, 
                var(--gold) 35%, 
                #FFF5D6 50%, 
                var(--gold) 65%, 
                var(--gold-dark) 100%
            );
            background-size: 200% auto;
            color: transparent; /* Make text transparent to show background */
            -webkit-background-clip: text;
            background-clip: text;
            animation: shimmer 12s linear infinite; /* Slower, more relaxed speed */
        }
        
        .separator-line {
            /* Line Shimmer Effect */
            background: linear-gradient(
                120deg, 
                var(--gold-dark) 0%, 
                var(--gold) 35%, 
                #FFF5D6 50%, 
                var(--gold) 65%, 
                var(--gold-dark) 100%
            );
            background-size: 200% auto;
            /* No need for clip text on div line */
            animation: shimmer 12s linear infinite;
            opacity: 1; /* Remove opacity to let shimmer show full brightness */
            
            /* Responsive Width */
            width: 90%; /* Adapt to container width */
            max-width: 360px; /* Cap at elegant length */
        }

        .card-text-main {
            font-family: 'Bodoni Moda SC', serif;
            /* Adjusted size for single line */
            font-size: clamp(1.2rem, 3.5vw, 2.2rem);
            white-space: nowrap; 
            /* color property is overridden by background-clip logic above */
            text-align: center;
            font-weight: 400;
            letter-spacing: 0.05em;
            
            /* Fix clipping: Italianno has long descenders */
            line-height: 1.15; 
            padding-bottom: 5px; /* Add breathing room for descenders */
            margin-bottom: -5px; /* Pull content back up to maintain compact look */
            margin-top: 0;
            display: block; /* Ensure block layout for proper height calc */
        }

        /* --- Split Image Logic (Relative Layout) --- */
        .framed-image-half {
            position: relative; /* Changed from absolute to relative */
            flex-shrink: 0; /* Prevent shrinking */
            
            /* Reverted to WIDTH based sizing to ensure exact match between top and bottom halves */
            /* Using width ensures both halves calculate identical dimensions regardless of container height variations */
            width: min(48vw, 250px);
            aspect-ratio: 989 / 512;
            height: auto;
            
            /* Backup max-width */
            max-width: 90%;

            background-color: var(--card-white);
            box-sizing: border-box;
            overflow: hidden;
            z-index: 10;
        }

        .framed-image-half img {
            position: relative;
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
            background-color: #fff;
            box-sizing: border-box;
        }

        /* Top Half */
        .framed-image-half.top {
            padding: 12px 12px 0 12px;
            border-top: 2px solid rgba(0,0,0,0.15); 
            border-left: 2px solid rgba(0,0,0,0.15); 
            border-right: 2px solid #ffffff; 
            border-bottom: none;
            box-shadow: inset 1px 1px 3px rgba(0,0,0,0.1); 
            
            /* Ensure it sits at the bottom of the top flex container */
            margin-bottom: 0;
        }
        
        .framed-image-half.top img {
            border-top: 1px solid rgba(0,0,0,0.2); 
            border-left: 1px solid rgba(0,0,0,0.2);
            border-right: 1px solid #ffffff; 
            border-bottom: none;
        }

        /* Bottom Half */
        .framed-image-half.bottom {
            padding: 0 12px 12px 12px;
            border-bottom: 2px solid #ffffff; 
            border-left: 2px solid rgba(0,0,0,0.15); 
            border-right: 2px solid #ffffff; 
            border-top: none;
            box-shadow: inset 1px 0px 3px rgba(0,0,0,0.1); 
            
            /* Ensure it sits at the top of the bottom flex container */
            margin-top: 0;
        }
        
        .framed-image-half.bottom img {
            border-bottom: 1px solid #ffffff; 
            border-right: 1px solid #ffffff;
            border-left: 1px solid rgba(0,0,0,0.2); 
            background: var(--card-white);
        }

        /* --- Inner Content Animation (Fade in after open) --- */
        /* Target specific content: Text wrappers and Images inside frames */
        /* Frames themselves (.framed-image-half) remain visible */
        .face-back .text-area-top,
        .card-lower .text-area-bottom,
        .framed-image-half img {
            opacity: 0;
            /* transform: translateY(15px); <--- Removed slide-up */
            transition: opacity 1.5s ease-out; /* Removed transform transition */
            transition-delay: 0s; 
        }

        /* When card is open, trigger fade in with delay */
        .card-container.card-open .face-back .text-area-top,
        .card-container.card-open .card-lower .text-area-bottom,
        .card-container.card-open .framed-image-half img {
            opacity: 1;
            /* transform: translateY(0); <--- Removed slide-up */
            transition-delay: 2.6s; 
        }

        /* Message Text Specific Styling */
        .message-text {
            font-family: 'Noto Serif JP', serif;
            font-size: clamp(0.38rem, 1.2vw, 0.6rem);
            color: #555;
            text-align: center;
            width: 90%; 
            line-height: 1.6;
            font-feature-settings: "palt";
            letter-spacing: -0.05em;
            word-break: keep-all;
            overflow-wrap: normal;
            margin: 0; /* Handled by flex container */
        }

        /* Media query for smaller devices */
        @media (max-width: 400px) {
            /* Shrink image slightly on very small screens to ensure text doesn't overlap */
            /* Using Width based sizing here as well */
            .framed-image-half {
                width: min(44vw, 220px);
                /* Height auto calculated by aspect-ratio */
            }
            
            .face-back {
                padding-top: 30px; 
            }
            
            .card-lower {
                padding-bottom: 35px; 
            }
            
            .message-text {
                line-height: 1.4;
            }
        }

        /* Snow Canvas */
        #snow-canvas {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            pointer-events: none;
            z-index: 1; /* Above bokeh */
        }

        /* UI Controls */
        .ui-layer {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 100;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            background: #882426; 
            backdrop-filter: blur(5px);
            transition: opacity 1s;
        }

        .ui-layer.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .input-group {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 20px;
            text-align: center;
        }



        .btn-open {
            padding: 12px 40px;
            border: 1px solid var(--gold);
            background: rgba(197, 160, 89, 0.2);
            color: var(--gold);
            font-family: 'Cinzel', serif;
            font-size: 1.2rem;
            cursor: pointer;
            transition: all 0.3s;
            text-transform: uppercase;
            letter-spacing: 0.1em;
        }
        .btn-open:hover {
            background: var(--gold);
            color: #000;
            box-shadow: 0 0 20px var(--gold-dark);
        }

        .sound-toggle {
            margin-top: 20px;
            color: rgba(255,255,255,0.6);
            cursor: pointer;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        

    </style>
</head>
<body>

    <!-- Snow Effect -->
    <canvas id="snow-canvas"></canvas>

    <!-- Intro Overlay -->
    <div id="login-overlay" class="ui-layer">
        <div class="mb-8 text-center text-white">
            <h1 class="text-2xl md:text-4xl font-light tracking-widest font-[Cinzel] flex flex-col md:block items-center gap-2 md:gap-0">
                <span class="whitespace-nowrap">Taro Ashihara</span>
                <span class="hidden md:inline mx-2">/</span>
                <span class="whitespace-nowrap">Yuki Ashihara</span>
            </h1>
            <p class="text-sm md:text-base mt-2 tracking-widest text-gray-400">SEASON'S GREETINGS</p>
        </div>

        <div class="input-group">
            <button id="login-btn" class="px-8 py-2 border border-white text-white font-light tracking-widest hover:bg-white hover:text-gray-900 transition duration-300 font-[Cinzel]">
                OPEN
            </button>

            <!-- Landing Page Sound Notification/Toggle -->
            <div class="mt-6 flex flex-col items-center gap-2 text-white/80 font-light tracking-wider text-sm">
                <p class="text-xs opacity-70">This experience includes sound.</p>
                <button id="landing-sound-toggle" class="flex items-center gap-2 hover:text-white transition-colors">
                    <div id="landing-sound-icon">
                        <!-- Sound On Icon -->
                        <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path></svg>
                    </div>
                    <span id="landing-sound-text">Sound: ON</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Persistent Sound Control (Hidden initially) -->
    <div id="sound-control" class="fixed top-5 right-5 z-50 opacity-0 pointer-events-none transition-opacity duration-1000">
        <button id="toggle-sound-btn" class="text-white/70 hover:text-white transition-colors p-2" aria-label="Toggle Sound">
            <!-- Icon for Sound On (Speaker Wave) -->
            <svg id="icon-sound-on" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round" class="w-6 h-6"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path></svg>
            <!-- Icon for Sound Off (Speaker X) -->
            <svg id="icon-sound-off" class="hidden w-6 h-6" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><line x1="23" y1="9" x2="17" y2="15"></line><line x1="17" y1="9" x2="23" y2="15"></line></svg>
        </button>
    </div>

    <!-- Background Music -->
    <audio id="bgm" src="snowflakes-fall.mp3" loop></audio>
    
    <!-- Bokeh Background Container -->
    <div id="bokeh-container"></div>

    <!-- Main 3D Scene -->
    <div class="scene">
        <div class="envelope-wrapper" id="envelope">
            <div class="envelope-back"></div>
            
            <!-- Card -->
            <div class="card-container" id="card-container">
                <div class="card">
                    <!-- Lower Part (Static Base) -->
                    <div class="card-lower">
                        <!-- Border for lower part (handled by CSS now) -->
                        <div class="gold-border-double"></div>
                        
                        <!-- Image Bottom Half -->
                        <div class="framed-image-half bottom">
                             <!-- ここに下半分用画像(989x512)のパスを指定してください -->
                             <img src="img_02.png" alt="Architecture Sketch Bottom">
                        </div>

                        <!-- Text Wrapper for centering -->
                        <div class="text-area-bottom">
                            <p class="message-text">
                               1961年、芦原義信と初子は叔父の藤田嗣治のパリのアトリエを訪れました。<br>
    その際、太郎は叔父へ東京タワーの絵を描いて贈り、作品を交換するかたちで、<br>
    本作をプレゼントされました。
    <span style="display: block; margin-top: 15px;">
        2026年が穏やかで輝きに満ちた1年になりますよう<br>
        心よりお祈りいたします。
    </span>
                            </p>
                        </div>
                    </div>

                    <!-- Upper Part (Moving Flap) -->
                    <div class="card-upper" id="card-upper">
                        <!-- Front Face (Cover) -->
                        <div class="face face-front">
                            <div class="front-border-inner"></div>
                            
                            <!-- Stamp (Keeping it as it doesn't conflict with center, but user might want it gone? I'll leave it for now but maybe later remove if requested) -->
                            <div class="stamp-placeholder">
                                <img src="切手.png" alt="Stamp">
                            </div>

                            <!-- Centered Text Group -->
                            <div class="front-content-wrapper">
                                <!-- Title -->
                                <div class="card-text-main">
                                    Season's Greetings
                                </div>

                                <!-- Separator Line -->
                                <div class="separator-line"></div>

                                <!-- Names -->
                                <div class="front-signatures">
                                    Taro Ashihara &middot; Yuki Ashihara
                                </div>
                            </div>
                        </div>

                        <!-- Back Face (Inside Top) -->
                        <div class="face face-back">
                             <!-- Border for upper part (handled by CSS now) -->
                            <div class="gold-border-double"></div>
                            
                            <!-- Text Wrapper for centering -->
                            <div class="text-area-top">
                                <div class="card-text-main">
                                    Warmest Wishes
                                </div>
                            </div>

                            <!-- Image Top Half -->
                            <div class="framed-image-half top">
                                <!-- ここに上半分用画像(989x512)のパスを指定してください -->
                                <img src="img_01.png" alt="Architecture Sketch Top">
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="envelope-body">
                <svg viewBox="0 0 500 330" preserveAspectRatio="none">
                    <!-- Shape Fill (No Border) -->
                    <path class="envelope-shape" d="M 0 0 L 250 165 L 500 0 L 500 330 L 0 330 Z"></path>
                    
                    <!-- Top V Border REMOVED as per user request (only flap has border) -->
                    <!-- <path class="envelope-lines" d="M 0 0 L 250 165 L 500 0" vector-effect="non-scaling-stroke"></path> -->
                    
                    <!-- Diagonal Seam Lines REMOVED as per user request -->
                    <!-- <path class="envelope-lines" d="M 0 330 L 250 165 M 500 330 L 250 165" vector-effect="non-scaling-stroke"></path> -->
                    
                    <image href="" width="100%" height="100%" preserveAspectRatio="none" style="mix-blend-mode: multiply; opacity: 0.3; pointer-events: none;" /> 
                </svg>
                
                <div class="envelope-signatures">
                    Taro Ashihara &nbsp; Yuki Ashihara
                </div>
            </div>
            
            <div class="envelope-flap" id="flap">
                <div class="flap-content flap-outer">
                    <svg viewBox="0 0 500 181" preserveAspectRatio="none">
                        <!-- Shape Fill -->
                        <path class="envelope-shape" d="M 0 0 L 250 181 L 500 0 Z"></path>
                        
                         <!-- Triangle V Border (No top border) -->
                        <path class="envelope-lines" d="M 0 0 L 250 181 L 500 0" vector-effect="non-scaling-stroke"></path>
                    </svg>
                    <div class="envelope-seal">
                        <!-- 
                             To use a custom image:
                             1. Prepare a PNG image with transparency.
                             2. Uncomment the img tag below.
                             3. Set the 'src' attribute to your image path.
                             4. The CSS seal will automatically be covered.
                        -->
                        <img src="stamp.png" alt="Wax Seal" class="seal-image">
                        
                        <div class="seal-css"></div>
                    </div>
                </div>
                <div class="flap-content flap-inner">
                    <svg viewBox="0 0 500 181" preserveAspectRatio="none">
                        <!-- Shape Fill Only -->
                        <path class="envelope-shape" d="M 0 0 L 250 181 L 500 0 Z"></path>
                    </svg>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- Configuration ---
        // --- Configuration ---
        let isCardOpen = false;

        // --- Preload Assets ---
        function preloadAssets() {
            const assets = [
                'img_01.png', 
                'img_02.png', 
                '切手.png',
                'snowflakes-fall.mp3' // Preload audio too
            ];
            assets.forEach(src => {
                if (src.endsWith('.mp3')) {
                    const audio = new Audio();
                    audio.src = src;
                    audio.preload = 'auto';
                } else {
                    const img = new Image();
                    img.src = src;
                }
            });
        }
        // Start preloading immediately
        preloadAssets();
 
        // --- Elements ---

        const loginOverlay = document.getElementById('login-overlay');
        const envelope = document.getElementById('envelope');
        const flap = document.getElementById('flap');
        const cardContainer = document.getElementById('card-container');
        const cardUpper = document.getElementById('card-upper');
        const seal = document.querySelector('.envelope-seal');

        const bgm = document.getElementById('bgm'); // Assuming an audio element with id="bgm" will be added
        const loginBtn = document.getElementById('login-btn');
        const soundControl = document.getElementById('sound-control');
        const toggleSoundBtn = document.getElementById('toggle-sound-btn');
        const iconSoundOn = document.getElementById('icon-sound-on');
        const iconSoundOff = document.getElementById('icon-sound-off');
        
        // Landing Page Elements
        const landingSoundToggle = document.getElementById('landing-sound-toggle');
        const landingSoundIcon = document.getElementById('landing-sound-icon');
        const landingSoundText = document.getElementById('landing-sound-text');

        let isMuted = false;

        // Icons SVG Strings for Landing Page
        const svgSoundOn = `<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><path d="M19.07 4.93a10 10 0 0 1 0 14.14M15.54 8.46a5 5 0 0 1 0 7.07"></path></svg>`;
        const svgSoundOff = `<svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"><polygon points="11 5 6 9 2 9 2 15 6 15 11 19 11 5"></polygon><line x1="23" y1="9" x2="17" y2="15"></line><line x1="17" y1="9" x2="23" y2="15"></line></svg>`;

        // --- Landing Page Sound Toggle Logic ---
        if (landingSoundToggle) {
            landingSoundToggle.addEventListener('click', () => {
                isMuted = !isMuted;
                updateLandingSoundUI();
                
                // Sync actual audio mute state if it exists (for pre-load interaction?)
                // Usually audio won't play until gesture anyway, but we set the variable
                if(bgm) bgm.muted = isMuted;
            });
        }

        function updateLandingSoundUI() {
            if (isMuted) {
                landingSoundText.textContent = "Sound: OFF";
                landingSoundIcon.innerHTML = svgSoundOff;
                landingSoundToggle.classList.add('opacity-70');
            } else {
                landingSoundText.textContent = "Sound: ON";
                landingSoundIcon.innerHTML = svgSoundOn;
                landingSoundToggle.classList.remove('opacity-70');
            }
        }

        // --- Persistent Sound Toggle Logic ---
        toggleSoundBtn.addEventListener('click', (e) => {
            e.stopPropagation(); // Prevent card interaction
            if (bgm.paused) {
                bgm.play().then(() => {
                    isMuted = false;
                    updateSoundIcon();
                }).catch(e => console.log("Audio resume failed", e));
            } else {
                if (bgm.muted) {
                    bgm.muted = false;
                    isMuted = false;
                } else {
                    bgm.muted = true;
                    isMuted = true;
                }
                updateSoundIcon();
            }
        });

        function updateSoundIcon() {
            if (isMuted || bgm.muted) {
                iconSoundOn.classList.add('hidden');
                iconSoundOff.classList.remove('hidden');
            } else {
                iconSoundOn.classList.remove('hidden');
                iconSoundOff.classList.add('hidden');
            }
        }

        // --- Event Listeners ---
        loginBtn.addEventListener('click', () => {
             startExperience();
        });

        // --- Animation Sequence ---
        function startExperience() {
            const overlay = document.getElementById('login-overlay');
            
            // 1. Fade out Login Overlay smoothly
            // Ensure transition class is present (it is in CSS: transition: opacity 1s)
            // We'll extend duration slightly for elegance if needed via inline or rely on CSS
            overlay.style.transition = 'opacity 1.5s ease-in-out';
            overlay.style.opacity = '0';
            
            // Remove from DOM after fade completes
            setTimeout(() => {
                overlay.style.display = 'none';
                
                // Show Sound Control after overlay is gone
                soundControl.classList.remove('opacity-0', 'pointer-events-none');
            }, 1500);

            // Audio handling
            if (bgm) {
                bgm.volume = 0.5;
                // Apply the preference set on landing page
                bgm.muted = isMuted;
                
                // Sync persistent icon
                updateSoundIcon(); // Changed from updatePersistentSoundIcon to updateSoundIcon

                bgm.play().then(() => {
                    // Playback started
                }).catch(error => {
                    console.log("Audio play failed", error);
                    isMuted = true;
                    bgm.muted = true;
                    updateSoundIcon(); // Changed from updatePersistentSoundIcon to updateSoundIcon
                });
            }

            // 2. Fly in Envelope (Wait for overlay to fade out completely + pause)
            // Overlay fade: 1500ms. Enter envelope at 2000ms.
            setTimeout(() => {
                envelope.classList.add('animate-in');
            }, 2000);

            // 3. Fade Out Seal (Wait for envelope to arrive 2000+2500=4500)
            setTimeout(() => {
                if(seal) seal.classList.add('fade-out');
            }, 4500);

            // 4. Open Flap (After seal fades)
            // Wait 1s for fade (4500+1000=5500)
            setTimeout(() => {
                flap.classList.add('open');
            }, 5500);

            // 5. Pull out Card
            // Shifted by +500ms from previous 6000
            setTimeout(() => {
                cardContainer.classList.add('pulled-out');
            }, 6500);

            // Wait for pull out to finish (6500 start + 2500 duration = 9000ms total)
            setTimeout(() => {
                // Temporarily disable transition to prevent Safari from interpolating from base state
                cardContainer.style.transition = 'none';
                
                cardContainer.classList.remove('pulled-out');
                cardContainer.classList.add('interactive');
                
                // Force reflow
                void cardContainer.offsetWidth;
                
                // Restore transition
                cardContainer.style.transition = '';
            }, 9000);

            // 6. Open Card (First Time)
            setTimeout(() => {
                toggleCard();
            }, 9500);  
        }

        // --- Card Interaction ---
        function toggleCard() {
            isCardOpen = !isCardOpen;
            if (isCardOpen) {
                cardContainer.classList.add('card-open');
                playChime();
            } else {
                cardContainer.classList.remove('card-open');
            }
        }

        // Click handler for card
        cardContainer.addEventListener('click', (e) => {
            // Only allow interaction if the card is ready (has interactive class)
            // or if we clicked while it was already open/transitioning
            if (cardContainer.classList.contains('interactive') || cardContainer.classList.contains('card-open')) {
                toggleCard();
            }
        });


        // --- Snow Effect ---
        const canvas = document.getElementById('snow-canvas');
        const ctx = canvas.getContext('2d');
        let width, height;
        const particles = [];

        function resize() {
            // Mobile Optimization: Lower resolution on small screens
            const isMobile = window.innerWidth < 768;
            const dpr = isMobile ? 0.5 : 1; // Lower density for mobile
            
            width = canvas.width = window.innerWidth * dpr;
            height = canvas.height = window.innerHeight * dpr;
            
            // Adjust scale logic if needed, but for snow just mapping coordinate space is enough
            // We might need to scale context if we wanted exact 1:1 match, but for snow randomness it's fine.
            // Actually, to keep particles looking same size relative to screen, we need to account for this.
            // But simpler is just to let them be "coarser" on mobile.
        }

        class Particle {
            constructor() {
                this.reset();
            }
            reset() {
                this.x = Math.random() * width;
                this.y = Math.random() * -height;
                this.speed = Math.random() * 1 + 1; 
                this.size = Math.random() * 2 + 1;
                this.drift = Math.random() * 1 - 0.5;
            }
            update() {
                this.y += this.speed;
                this.x += this.drift;
                if (this.y > height) this.reset();
            }
            draw() {
                ctx.fillStyle = 'rgba(255, 255, 255, 0.8)';
                ctx.beginPath();
                ctx.arc(this.x, this.y, this.size, 0, Math.PI * 2);
                ctx.fill();
            }
        }

        function initSnow() {
            resize();
            for (let i = 0; i < 100; i++) {
                particles.push(new Particle());
            }
            animateSnow();
        }

        function animateSnow() {
            ctx.clearRect(0, 0, width, height);
            particles.forEach(p => {
                p.update();
                p.draw();
            });
            requestAnimationFrame(animateSnow);
        }

        window.addEventListener('resize', resize);
        initSnow();
        
        // --- Bokeh Effect ---
        function initBokeh() {
            const container = document.getElementById('bokeh-container');
            // Mobile Optimization: Fewer particles
            const isMobile = window.innerWidth < 768;
            const lightCount = isMobile ? 15 : 35; 

            for (let i = 0; i < lightCount; i++) {
                const light = document.createElement('div');
                light.classList.add('bokeh-light');
                
                // Random Size (Increased as requested)
                const size = Math.random() * 180 + 80; // 80px to 260px
                light.style.width = `${size}px`;
                light.style.height = `${size}px`;
                
                // Random Position (Wider range to act as background)
                // Allow spawning slight off-screen for better coverage
                light.style.left = `${Math.random() * 120 - 10}%`;
                light.style.top = `${Math.random() * 120 - 10}%`;
                
                // Random Color Variant (Warm golds/whites)
                const hue = Math.random() < 0.5 ? '255, 255, 255' : '255, 223, 150'; // White or Warm Gold
                light.style.background = `radial-gradient(circle, rgba(${hue}, 0.3) 0%, rgba(${hue}, 0) 70%)`;

                // Random Animation Delays/Duration to avoid sync
                light.style.animationDuration = `${Math.random() * 20 + 15}s, ${Math.random() * 6 + 4}s`; // float, twinkle durations
                light.style.animationDelay = `${Math.random() * -20}s, ${Math.random() * -10}s`;
                
                container.appendChild(light);
            }
        }
        initBokeh();

    </script>
</body>
</html>